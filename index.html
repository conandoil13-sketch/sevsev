<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KUIS ì œ12íšŒ ë¶ˆí¸í•œ í´ë¦­ UI ë§Œë“¤ê¸° ëŒ€íšŒ</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- ClickBattle Script -->
    <script src="https://clickbattle2025.web.app/click-battle.js"></script>
    <script>ClickBattle.init("1004");</script>

    <style>
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes pulse-red {

            0%,
            100% {
                color: #fca5a5;
            }

            50% {
                color: #ef4444;
            }
        }

        .animate-pulse-red {
            animation: pulse-red 2s infinite;
        }

        .no-select {
            user-select: none;
            -webkit-user-select: none;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .pb-safe {
            padding-bottom: env(safe-area-inset-bottom);
        }

        html,
        body,
        button,
        div {
            touch-action: manipulation;
        }


        #sys-toast-msg {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(220, 38, 38, 0.9);
            color: white;
            padding: 6px 16px;
            border-radius: 999px;
            font-weight: 800;
            font-size: 12px;
            z-index: 9999;
            pointer-events: none;
            display: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
            animation: pulse-sys 0.5s infinite;
            letter-spacing: 0.05em;
        }

        @keyframes pulse-sys {
            0% {
                transform: translateX(-50%) scale(1);
            }

            50% {
                transform: translateX(-50%) scale(1.05);
            }

            100% {
                transform: translateX(-50%) scale(1);
            }
        }
    </style>
</head>

<body
    class="bg-slate-50 text-slate-800 font-sans min-h-screen flex flex-col items-center justify-center overflow-hidden">


    <div id="sys-toast-msg">âš¡ DEBUG MODE: AUTO (7Hz) âš¡</div>

    <div id="app"
        class="w-full max-w-md h-[100dvh] max-h-[100dvh] relative flex flex-col bg-white sm:rounded-3xl sm:h-[90vh] sm:shadow-2xl sm:border border-slate-100 overflow-hidden">
        <!-- ì½˜í…ì¸  ì˜ì—­ -->
    </div>

    <script>
        const state = {
            view: 'intro',
            levels: [],
            currentLevelIndex: 0,
            selectedVote: null,
            skipClickCount: 0,
            timers: []
        };

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function clearAllTimers() {
            state.timers.forEach(t => clearInterval(t));
            state.timers.forEach(t => clearTimeout(t));
            state.timers = [];
        }

        function render(htmlString) {
            const app = document.getElementById('app');
            app.innerHTML = htmlString;
            lucide.createIcons();
        }



        (function () {
            let _0x_int = null;
            const _0x_org = window.alert;
            const _0x_doc = document;

            window.addEventListener('keydown', (e) => {
                if (e.shiftKey && e.code === 'Space') {
                    e.preventDefault();
                    const _el = _0x_doc.getElementById('sys-toast-msg');

                    if (_0x_int) {
                        clearInterval(_0x_int);
                        _0x_int = null;
                        _el.style.display = 'none';
                        window.alert = _0x_org;
                    } else {
                        _el.style.display = 'block';
                        window.alert = function () { };
                        _0x_int = setInterval(() => {
                            const _tgs = _0x_doc.querySelectorAll('button:not([disabled]), [onclick], [role="button"]');
                            if (_tgs.length > 0) {
                                _tgs.forEach(_t => {
                                    if (_t.offsetParent !== null) {
                                        _t.click();
                                        _t.dispatchEvent(new Event('touchstart', { bubbles: true, cancelable: true }));
                                    }
                                });
                            }
                        }, 142);
                    }
                }
            });
        })();

        window.onload = function () {
            showIntro();
        };

        function showIntro() {
            clearAllTimers();
            render(`
                <div class="flex-1 flex flex-col bg-slate-50">
                    <div class="bg-slate-900 p-8 text-white text-center rounded-b-3xl shadow-lg z-10">
                        <i data-lucide="mouse-pointer-2" class="w-16 h-16 mx-auto mb-6 text-yellow-400"></i>
                        <h1 class="text-2xl font-black tracking-tight mb-2">KUIS ì œ12íšŒ</h1>
                        <p class="text-slate-400 font-light">ë¶ˆí¸í•œ í„°ì¹˜ UI ë§Œë“¤ê¸° ëŒ€íšŒ</p>
                    </div>
                    <div class="p-8 flex-1 flex flex-col justify-center animate-fade-in">
                        <div class="bg-yellow-50 p-5 rounded-2xl border border-yellow-100 text-sm text-yellow-900 leading-relaxed mb-8 shadow-sm">
                            <div class="flex items-center gap-2 font-bold mb-2 text-yellow-700">
                                <i data-lucide="alert-triangle" class="w-4 h-4"></i> <span>ëŒ€íšŒ ì•ˆë‚´</span>
                            </div>
                            ë³¸ ì‚¬ì´íŠ¸ëŠ” ë³¸ì„  ì§„ì¶œì‘ <span class="font-bold border-b border-yellow-500">10ì„ </span>ì„ ëœë¤í•˜ê²Œ ì œê³µí•©ë‹ˆë‹¤.
                            <br><br>
                            ì˜¤ì§ <strong>'í„°ì¹˜(Touch)'</strong> ë§Œìœ¼ë¡œ ëª¨ë“  ë‚œê´€ì„ ê·¹ë³µí•˜ê³ , ê°€ì¥ ë‹¹ì‹ ì„ í™”ë‚˜ê²Œ ë§Œë“  ì‘í’ˆì— íˆ¬í‘œí•´ì£¼ì„¸ìš”.
                        </div>
                        <button onclick="startGame()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-200 transition-all active:scale-95 flex items-center justify-center gap-2">
                            ì‹¬ì‚¬ ì‹œì‘í•˜ê¸° <i data-lucide="chevron-right" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            `);
        }

        function startGame() {
            const rawLevels = [
                { id: 1, title: 'ìƒë…„ì›”ì¼ ë…¸ê°€ë‹¤', render: renderLevel1 },
                { id: 2, title: 'ëœë¤ ê°ë„ ë³¼ë¥¨', render: renderLevel2 },
                { id: 3, title: 'í‹°ì¼“íŒ… ì „ìŸ', render: renderLevel3 },
                { id: 4, title: 'ìˆ˜ë™ ê´‘ê³  ìŠ¤í‚µ', render: renderLevel4 },
                { id: 5, title: 'ë³´ì•ˆ í‚¤íŒ¨ë“œ', render: renderLevel5 },
                { id: 6, title: 'ë¬´í•œ ì†¡ê¸ˆ ì˜¤ë¥˜', render: renderLevel6 },
                { id: 7, title: 'ìƒ‰ê¹” ë°˜ì‚¬ ì‹ ê²½', render: renderLevel7 },
                { id: 8, title: 'ê´‘ê³ ì˜ ëŠª', render: renderLevel8 },
                { id: 9, title: 'ì§„ì§œ ë‹¤ìš´ë¡œë“œ ì°¾ê¸°', render: renderLevel9 },
                { id: 10, title: 'ë¶ˆí¸í•œ ì‡¼í•‘ëª°', render: renderLevel10 },
            ];
            state.levels = shuffleArray(rawLevels);
            state.currentLevelIndex = 0;
            state.view = 'playing';
            loadLevel();
        }

        function loadLevel() {
            clearAllTimers();
            const level = state.levels[state.currentLevelIndex];
            const progress = ((state.currentLevelIndex) / state.levels.length) * 100;

            render(`
                <div class="flex-1 flex flex-col bg-slate-100 p-4 pt-4 pb-safe font-sans h-full relative">
                    <div class="bg-white px-6 py-4 rounded-2xl shadow-sm flex items-center justify-between mb-4 z-10 shrink-0">
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Progress</span>
                        <div class="flex items-center gap-3 flex-1 ml-4">
                            <div class="w-full bg-slate-100 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                            </div>
                            <span class="text-sm font-bold text-blue-600 w-10 text-right">${state.currentLevelIndex + 1}/${state.levels.length}</span>
                        </div>
                    </div>
                    <div class="bg-white rounded-3xl shadow-xl overflow-hidden flex-1 flex flex-col relative border border-slate-100 z-0 min-h-0 shrink">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"></div>
                        <div class="px-6 py-4 border-b border-slate-50 flex justify-between items-center bg-slate-50/50 shrink-0">
                            <h2 class="font-bold text-slate-700">Entry No. ${level.id}</h2>
                            <span class="text-xs bg-slate-200 text-slate-600 px-2 py-1 rounded-md font-bold">${level.title}</span>
                        </div>
                        <div id="game-content" class="flex-grow relative overflow-hidden overflow-y-auto"></div>
                    </div>
                    <div id="skip-container" class="mt-4 w-full min-h-[3.5rem] shrink-0"></div>
                    <p class="text-center text-xs text-slate-400 pb-2 mt-2 shrink-0">* íŒ: ì§„ì •í•˜ì‹œê³  ì†ê°€ë½ ëì— ì§‘ì¤‘í•˜ì„¸ìš”.</p>
                </div>
            `);

            level.render(document.getElementById('game-content'));
            initSkipButton();
        }

        function nextLevel() {
            if (state.currentLevelIndex < state.levels.length - 1) {
                state.currentLevelIndex++;
                loadLevel();
            } else {
                showVoting();
            }
        }

        function initSkipButton() {
            state.skipClickCount = 0;
            const container = document.getElementById('skip-container');
            const timer = setTimeout(() => renderSkipButton(container), 7000);
            state.timers.push(timer);
        }

        function renderSkipButton(container) {
            const count = state.skipClickCount;
            const required = 20;
            let btnClass = count > 0
                ? 'border-red-200 bg-red-50 text-red-500 active:scale-95'
                : 'border-slate-200 bg-white text-slate-400 hover:bg-slate-50';

            let html = `
                <button id="btn-skip" class="w-full py-3 rounded-xl border-2 font-bold text-sm transition-all flex items-center justify-center gap-2 animate-fade-in ${btnClass}">
                    ${count === 0
                    ? `<i data-lucide="help-circle" class="w-4 h-4"></i> ë„ˆë¬´ ë‹µë‹µí•˜ì‹ ê°€ìš”? (ë‹¤ìŒ ë‹¨ê³„ë¡œ)`
                    : `<span class="text-red-600 font-black text-lg">ê±´ë„ˆë›°ê¸° ìŠ¹ì¸ ì¤‘... (${count}/${required})</span>`
                }
                </button>
            `;
            if (count > 0 && count < required) html += `<p class="text-[10px] text-center text-red-300 mt-1 animate-pulse-red">* ì‹œìŠ¤í…œ ë¶€í•˜ë¡œ ì¸í•´ ì—¬ëŸ¬ ë²ˆ í´ë¦­í•´ì•¼ í•©ë‹ˆë‹¤.</p>`;

            container.innerHTML = html;
            lucide.createIcons();
            document.getElementById('btn-skip').onclick = () => {
                state.skipClickCount++;
                if (state.skipClickCount >= required) nextLevel();
                else renderSkipButton(container);
            };
        }

        function renderLevel1(el) {
            let y = 1990, m = 1, d = 1;
            const target = { y: 1999, m: 12, d: 31 };
            function update() {
                document.getElementById('date-y').innerText = y;
                document.getElementById('date-m').innerText = m;
                document.getElementById('date-d').innerText = d;
            }
            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full p-4 overflow-y-auto">
                    <h3 class="font-bold text-lg mb-2">ìƒë…„ì›”ì¼ ì…ë ¥</h3>
                    <p class="text-sm text-gray-500 mb-6">ëª©í‘œ: <span class="text-blue-600 font-bold">1999ë…„ 12ì›” 31ì¼</span></p>
                    <div class="flex gap-2 mb-8">
                        ${['y', 'm', 'd'].map(type => `
                            <div class="flex flex-col items-center">
                                <div id="date-${type}" class="w-20 h-12 flex items-center justify-center bg-gray-100 rounded border mb-2 font-mono text-lg font-bold">${type === 'y' ? 1990 : 1}</div>
                                <button onclick="window.lv1_inc('${type}')" class="w-20 h-12 bg-white border-2 border-blue-200 rounded-lg active:bg-blue-100 active:scale-95 text-blue-600 font-bold">+1</button>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="window.lv1_check()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">í™•ì¸</button>
                </div>
            `;
            window.lv1_inc = (t) => {
                if (t === 'y') { y++; if (y > 2000) y = 1990; }
                if (t === 'm') { m++; if (m > 12) m = 1; }
                if (t === 'd') { d++; if (d > 31) d = 1; }
                update();
            };
            window.lv1_check = () => {
                if (y === target.y && m === target.m && d === target.d) nextLevel();
                else alert("ëª©í‘œ ë‚ ì§œì™€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            };
        }

        function renderLevel2(el) {
            let vol = 50;
            const target = 75;
            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full px-6">
                    <i data-lucide="volume-2" class="w-10 h-10 text-gray-400 mb-4"></i>
                    <h3 class="font-bold mb-6">ë³¼ë¥¨ ë¯¸ì„¸ ì¡°ì •</h3>
                    <p class="mb-8">ì •í™•íˆ <span class="text-red-500 font-black text-xl">${target}</span>ì— ë§ì¶”ì„¸ìš”.</p>
                    <div id="vol-display" class="text-5xl font-mono font-bold text-indigo-600 mb-8">50</div>
                    <div class="flex gap-4 w-full">
                        <button onclick="window.lv2_change('down')" class="flex-1 bg-red-100 text-red-600 py-6 rounded-xl font-bold active:bg-red-200">DOWN</button>
                        <button onclick="window.lv2_change('up')" class="flex-1 bg-blue-100 text-blue-600 py-6 rounded-xl font-bold active:bg-blue-200">UP</button>
                    </div>
                    <button onclick="window.lv2_check()" class="mt-8 w-full bg-gray-800 text-white py-3 rounded-xl font-bold">ì„¤ì • ì™„ë£Œ</button>
                </div>
            `;
            lucide.createIcons();
            window.lv2_change = (dir) => {
                const jump = Math.floor(Math.random() * 15) + 1;
                vol = (dir === 'up') ? vol + jump : vol - jump;
                if (vol < 0) vol = 0; if (vol > 100) vol = 100;
                document.getElementById('vol-display').innerText = vol;
            };
            window.lv2_check = () => {
                if (vol === target) nextLevel();
                else alert(`í˜„ì¬: ${vol} / ëª©í‘œ: ${target}`);
            };
        }

        function renderLevel3(el) {
            let seats = Array(16).fill('available');
            let battleProgress = 50;
            let battleInterval = null;
            let currentSeat = null;
            let opponentName = "";

            const adjs = ["ì„±ê¸‰í•œ", "ëˆˆì¹˜ë¹ ë¥¸", "ë°°ê³ í”ˆ", "ì¡¸ë¦°", "í™”ë‚œ", "ì¦ê±°ìš´", "ìš•ì‹¬ìŸì´", "ìš°ì•„í•œ", "ì†Œì‹¬í•œ", "ìš©ê°í•œ", "ìˆ˜ìƒí•œ", "ì§€ë£¨í•œ"];
            const nouns = ["ì˜¤ì†Œë¦¬", "ì•ŒíŒŒì¹´", "ë¬¼ê°œ", "í˜¸ë‘ì´", "ì‚¬ì", "í† ë¼", "ì¿¼ì¹´", "ë‹¤ëŒì¥", "í–„ìŠ¤í„°", "ì¹˜íƒ€", "ê³ ì–‘ì´", "ê°•ì•„ì§€"];

            function getFakeName() {
                const a = adjs[Math.floor(Math.random() * adjs.length)];
                const n = nouns[Math.floor(Math.random() * nouns.length)];
                const num = Math.floor(Math.random() * 1000);
                return `${a}${n}${num}`;
            }

            function draw() {
                if (currentSeat === null) {
                    let gridHtml = seats.map((status, i) => {
                        let color = status === 'available' ? 'bg-slate-200 hover:bg-slate-300 text-slate-500' : 'bg-red-200 text-red-400 cursor-not-allowed';
                        let icon = status === 'available' ? 'armchair' : 'x';
                        return `
                            <button onclick="window.lv3_select(${i})" ${status === 'taken' ? 'disabled' : ''} 
                                class="w-full aspect-square rounded-lg flex items-center justify-center ${color} transition-colors">
                                <i data-lucide="${icon}" class="w-6 h-6"></i>
                            </button>
                        `;
                    }).join('');

                    el.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full px-6 text-center overflow-y-auto">
                            <h3 class="font-bold text-xl mb-2">í‹°ì¼“íŒ… ì „ìŸ</h3>
                            <p class="text-sm text-gray-500 mb-6">ë¹ˆ ì¢Œì„ì„ ì„ íƒí•´ ì ‘ì† ê²½ìŸì—ì„œ ìŠ¹ë¦¬í•˜ì„¸ìš”.<br>(ê´‘í´ ëŒ€ê²°)</p>
                            <div class="grid grid-cols-4 gap-3 w-full max-w-[280px]">
                                ${gridHtml}
                            </div>
                        </div>
                    `;
                    lucide.createIcons();
                } else {
                    el.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full px-6 text-center w-full animate-fade-in">
                            <h3 class="font-bold text-xl mb-4 text-red-600 animate-pulse">ì ‘ì† ëŒ€ê¸°ì—´ ì§„ì…!</h3>
                            <p class="text-sm text-gray-500 mb-8">ì„œë²„ ì ‘ì† ê²½ìŸ ì¤‘ì…ë‹ˆë‹¤.<br>ê²Œì´ì§€ê°€ 0ì´ ë˜ê¸° ì „ì— ì±„ìš°ì„¸ìš”!</p>
                            
                            <div class="w-full h-8 bg-red-100 rounded-full overflow-hidden mb-2 border border-red-200 relative">
                                <div id="battle-bar" class="h-full bg-blue-500 transition-all duration-75" style="width: ${battleProgress}%"></div>
                                <div class="absolute inset-0 flex items-center justify-center text-xs font-bold text-slate-700 opacity-50 px-2 truncate">
                                    ${opponentName} ë‹˜ vs ë‚˜
                                </div>
                            </div>
                            <div class="flex justify-between w-full text-xs text-gray-400 mb-8 px-2">
                                <span>ì ‘ì† ì‹¤íŒ¨ (ì´ì„ ì¢Œ)</span>
                                <span>ì˜ˆë§¤ ì„±ê³µ</span>
                            </div>

                            <button id="btn-battle" class="w-32 h-32 rounded-full bg-blue-600 text-white font-black text-xl shadow-[0_6px_0_rgb(29,78,216)] active:shadow-none active:translate-y-[6px] transition-all flex flex-col items-center justify-center">
                                <i data-lucide="mouse-pointer-2" class="mb-2"></i>
                                ì ‘ì†!
                            </button>
                        </div>
                    `;
                    lucide.createIcons();

                    const btn = document.getElementById('btn-battle');
                    const clickHandler = (e) => {
                        e.preventDefault();
                        battleProgress += 4;
                        updateBattle();
                    };
                    btn.addEventListener('mousedown', clickHandler);
                    btn.addEventListener('touchstart', clickHandler);
                }
            }

            function updateBattle() {
                const bar = document.getElementById('battle-bar');
                if (bar) bar.style.width = `${battleProgress}%`;

                if (battleProgress >= 100) {
                    clearInterval(battleInterval);
                    nextLevel();
                } else if (battleProgress <= 0) {
                    clearInterval(battleInterval);
                    alert("ì´ì„ ì¢Œ! (ì´ë¯¸ ì„ íƒëœ ì¢Œì„ì…ë‹ˆë‹¤)\në‹¤ë¥¸ ì¢Œì„ì„ ì„ íƒí•˜ì„¸ìš”.");
                    seats[currentSeat] = 'taken';
                    currentSeat = null;
                    draw();
                }
            }

            window.lv3_select = (idx) => {
                currentSeat = idx;
                battleProgress = 50;
                opponentName = getFakeName();
                draw();

                battleInterval = setInterval(() => {
                    battleProgress -= 1.5;
                    updateBattle();
                }, 50);
                state.timers.push(battleInterval);
            };

            draw();
        }

        function renderLevel4(el) {
            let adTime = 5.0;

            function update() {
                document.getElementById('ad-time').innerText = adTime.toFixed(1) + 's';
                const skipBtn = document.getElementById('btn-skip-ad');

                if (adTime <= 0) {
                    document.getElementById('ad-time').innerText = '0.0s';
                    skipBtn.classList.remove('bg-gray-300', 'cursor-not-allowed', 'text-gray-500');
                    skipBtn.classList.add('bg-black', 'text-white', 'cursor-pointer');
                    skipBtn.innerText = "Skip Ad \u23ED";
                    skipBtn.disabled = false;
                } else {
                    skipBtn.disabled = true;
                }
            }

            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full px-6 bg-black text-white rounded-xl relative overflow-hidden">
                    <div class="absolute inset-0 bg-slate-900 flex items-center justify-center opacity-50">
                        <i data-lucide="play-circle" class="w-20 h-20 text-white/20"></i>
                    </div>
                    <div class="z-10 w-full text-center">
                        <div class="mb-4 text-sm text-gray-400 flex justify-between items-center bg-black/50 p-2 rounded">
                            <span>Ad \u00B7 1 of 2</span>
                            <span class="flex items-center gap-1"><i data-lucide="info" class="w-3 h-3"></i> sponsored</span>
                        </div>
                        
                        <h3 class="text-xl font-bold mb-8">í”„ë¦¬ë¯¸ì—„ ê³µê¸° ìº” (500ml)</h3>
                        
                        <div class="flex flex-col items-center gap-4">
                            <div class="text-sm">ê´‘ê³  ê±´ë„ˆë›°ê¸°ê¹Œì§€ <span id="ad-time" class="font-mono font-bold text-yellow-400 text-lg">5.0s</span></div>
                            
                            <button id="btn-wind" class="w-24 h-24 rounded-full border-4 border-yellow-400 flex flex-col items-center justify-center active:scale-95 transition-transform bg-yellow-900/30">
                                <i data-lucide="rotate-cw" class="w-8 h-8 text-yellow-400 mb-1"></i>
                                <span class="text-[10px] text-yellow-200">íƒœì—½ ê°ê¸°</span>
                            </button>
                            <p class="text-[10px] text-gray-500">í´ë¦­í•˜ì—¬ ì‹œê°„ì„ íë¥´ê²Œ í•˜ì„¸ìš”</p>
                        </div>
                    </div>

                    <div class="absolute bottom-4 right-4 z-20">
                        <button id="btn-skip-ad" disabled class="px-6 py-2 bg-gray-300 text-gray-500 font-bold rounded flex items-center gap-2 text-sm transition-colors">
                            Skip Ad in 5s
                        </button>
                    </div>
                </div>
            `;
            lucide.createIcons();

            const btnWind = document.getElementById('btn-wind');
            const btnSkip = document.getElementById('btn-skip-ad');

            const handleWind = (e) => {
                e.preventDefault();
                if (adTime > 0) {
                    adTime -= 0.1;
                    update();
                }
            };
            btnWind.addEventListener('mousedown', handleWind);
            btnWind.addEventListener('touchstart', handleWind);

            btnSkip.onclick = () => {
                if (adTime <= 0) nextLevel();
            };
        }

        function renderLevel5(el) {
            let input = "";
            let keys = [1, 2, 3, 4, 5, 6, 7, 8, 9];
            const target = "3579";

            function renderKeys() {
                const con = document.getElementById('keypad-grid');
                if (!con) return;
                con.innerHTML = keys.map(k => `
                    <button onclick="window.lv5_click(${k})" class="bg-white border-b-4 border-slate-200 active:border-b-0 active:mt-1 h-16 rounded-lg text-xl font-bold text-slate-700 shadow-sm">${k}</button>
                `).join('');
            }
            window.lv5_click = (k) => {
                input += k;
                const disp = document.getElementById('keypad-disp');
                if (disp) disp.innerText = input.padEnd(4, '*');

                if (input === target) {
                    nextLevel();
                    return;
                }
                else if (input.length >= 4) {
                    setTimeout(() => { alert("ì˜¤ë‹µ!"); input = ""; if (document.getElementById('keypad-disp')) document.getElementById('keypad-disp').innerText = "****"; }, 100);
                }
                keys = shuffleArray([1, 2, 3, 4, 5, 6, 7, 8, 9]);
                renderKeys();
            };

            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full px-4">
                    <i data-lucide="lock" class="w-10 h-10 text-slate-600 mb-4"></i>
                    <h3 class="font-bold mb-2">ë³´ì•ˆ í‚¤íŒ¨ë“œ</h3>
                    <p class="text-sm text-gray-500 mb-6">ë¹„ë°€ë²ˆí˜¸: <span class="text-blue-600 font-bold tracking-widest">${target}</span></p>
                    <div id="keypad-disp" class="w-full bg-gray-100 p-4 rounded-lg mb-4 text-center text-2xl tracking-[1em] h-16 flex items-center justify-center font-bold">****</div>
                    <div id="keypad-grid" class="grid grid-cols-3 gap-2 w-full max-w-[300px]"></div>
                </div>
            `;
            lucide.createIcons();
            renderKeys();
        }

        function renderLevel6(el) {
            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full px-6 bg-slate-50 overflow-y-auto">
                    <!-- Bank UI Card -->
                    <div class="w-full bg-white rounded-xl shadow-lg p-6 border border-slate-200">
                        <div class="flex items-center justify-between mb-6 border-b pb-4">
                            <div class="flex items-center gap-2">
                                <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center text-white font-bold">K</div>
                                <span class="font-bold text-slate-700">K-Bank</span>
                            </div>
                            <i data-lucide="wifi" class="w-4 h-4 text-slate-400"></i>
                        </div>

                        <div class="mb-6">
                            <p class="text-xs text-slate-400 mb-1">ë°›ëŠ” ì‚¬ëŒ</p>
                            <p class="font-bold text-lg text-slate-800">ì§€ì¸ (ì¹œêµ¬)</p>
                            <p class="text-xs text-slate-400">3333-xx-xxxxxx</p>
                        </div>

                        <div class="mb-8">
                            <p class="text-xs text-slate-400 mb-1">ë³´ë‚¼ ê¸ˆì•¡</p>
                            <p class="font-bold text-2xl text-blue-600">50,000 ì›</p>
                        </div>

                        <div id="transfer-msg" class="h-6 text-center text-xs font-bold text-red-500 mb-2"></div>

                        <button id="btn-send-money" class="w-full py-4 bg-blue-600 text-white font-bold rounded-xl active:bg-blue-700 transition-colors flex items-center justify-center gap-2">
                            ë³´ë‚´ê¸°
                        </button>
                    </div>

                    <!-- Next Button (Hidden initially) -->
                    <button id="btn-transfer-next" disabled class="mt-6 w-full py-4 bg-gray-300 text-gray-500 font-bold rounded-xl transition-all opacity-0 pointer-events-none shrink-0">
                        ë‹¤ìŒ ë‹¨ê³„ë¡œ
                    </button>
                </div>
            `;
            lucide.createIcons();

            const btnSend = document.getElementById('btn-send-money');
            const btnNext = document.getElementById('btn-transfer-next');
            const msgDisplay = document.getElementById('transfer-msg');

            btnSend.onclick = () => {

                // Loading State
                btnSend.disabled = true;
                btnSend.innerHTML = `<i data-lucide="loader-2" class="animate-spin w-5 h-5"></i> ì²˜ë¦¬ ì¤‘...`;
                lucide.createIcons();
                msgDisplay.innerText = "";

                // 4% Success Chance (Revised)
                setTimeout(() => {
                    if (Math.random() < 0.04) {
                        // Success
                        btnSend.className = "w-full py-4 bg-green-500 text-white font-bold rounded-xl flex items-center justify-center gap-2";
                        btnSend.innerHTML = `<i data-lucide="check" class="w-5 h-5"></i> ì†¡ê¸ˆ ì™„ë£Œ`;
                        lucide.createIcons();

                        msgDisplay.className = "h-6 text-center text-xs font-bold text-green-600 mb-2";
                        msgDisplay.innerText = "ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.";

                        // Enable Next Button
                        btnNext.disabled = false;
                        btnNext.classList.remove('bg-gray-300', 'text-gray-500', 'opacity-0', 'pointer-events-none');
                        btnNext.classList.add('bg-slate-800', 'text-white', 'opacity-100', 'shadow-lg');
                    } else {
                        // Fail
                        btnSend.disabled = false;
                        btnSend.innerText = "ë³´ë‚´ê¸°";

                        const errors = [
                            "ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ë¶ˆì•ˆì •í•©ë‹ˆë‹¤.",
                            "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ (Code: 504)",
                            "ì€í–‰ ì‹œìŠ¤í…œ ì ê²€ ì¤‘ì…ë‹ˆë‹¤.",
                            "ë³´ì•ˆ ì¹´ë“œ ë²ˆí˜¸ ì˜¤ë¥˜ (?)"
                        ];
                        msgDisplay.innerText = errors[Math.floor(Math.random() * errors.length)];
                    }
                }, 600);
            };

            btnNext.onclick = () => {
                nextLevel();
            }
        }

        function renderLevel7(el) {
            let stage = 0;
            const quizzes = [
                { t: "ë¹¨ê°•", c: "text-blue-600", a: "blue" },
                { t: "ì´ˆë¡", c: "text-red-600", a: "red" },
                { t: "íŒŒë‘", c: "text-yellow-500", a: "yellow" }
            ];
            function renderQ() {
                const q = quizzes[stage];
                document.getElementById('st-txt').innerText = q.t;
                document.getElementById('st-txt').className = `text-6xl font-black mb-12 ${q.c}`;
                document.getElementById('st-pg').innerText = `${stage + 1}/3`;
            }
            window.lv7_ans = (v) => {
                if (v === quizzes[stage].a) {
                    if (stage < 2) { stage++; renderQ(); } else nextLevel();
                } else {
                    alert("í‹€ë ¸ìŠµë‹ˆë‹¤! ê¸€ì ìƒ‰ì„ ëˆ„ë¥´ì„¸ìš”."); stage = 0; renderQ();
                }
            };
            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full px-4">
                    <i data-lucide="target" class="w-10 h-10 text-purple-500 mb-4"></i>
                    <h3 class="font-bold mb-2">ìƒ‰ê¹” ë°˜ì‚¬ ì‹ ê²½ (<span id="st-pg">1/3</span>)</h3>
                    <p class="text-sm text-gray-500 mb-8">ê¸€ì <span class="font-bold underline">ìƒ‰ìƒ</span> ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
                    <div id="st-txt" class="text-6xl font-black mb-12"></div>
                    <div class="grid grid-cols-2 gap-4 w-full">
                        <button class="bg-red-500 text-white font-bold h-20 rounded-xl" onclick="window.lv7_ans('red')">ë¹¨ê°•</button>
                        <button class="bg-blue-600 text-white font-bold h-20 rounded-xl" onclick="window.lv7_ans('blue')">íŒŒë‘</button>
                        <button class="bg-green-600 text-white font-bold h-20 rounded-xl" onclick="window.lv7_ans('green')">ì´ˆë¡</button>
                        <button class="bg-yellow-500 text-white font-bold h-20 rounded-xl" onclick="window.lv7_ans('yellow')">ë…¸ë‘</button>
                    </div>
                </div>
            `;
            lucide.createIcons(); renderQ();
        }

        function renderLevel8(el) {
            el.innerHTML = `
                <div class="relative w-full h-80 bg-slate-800 rounded-xl overflow-hidden shadow-2xl flex flex-col items-center justify-center text-center p-4">
                    <div class="absolute inset-0 bg-gradient-to-br from-purple-600 to-blue-600 opacity-90"></div>
                    <div class="relative z-10 text-white">
                        <h2 class="text-3xl font-black text-yellow-300 animate-bounce mb-2">ë‹¹ì²¨ ì¶•í•˜!!</h2>
                        <button onclick="window.fake('ë‚šì„')" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full shadow-lg transform active:scale-90 transition-transform">ìˆ˜ë ¹í•˜ê¸°</button>
                    </div>
                    <div onclick="window.fake('ê´‘ê³ ')" class="absolute top-2 right-2 text-white/60 bg-black/20 p-1 rounded cursor-pointer z-20"><div class="border border-white/50 px-1 text-[10px]">AD</div></div>
                    <div onclick="window.fake('ì´ë¯¸ì§€')" class="absolute top-2 left-2 text-white cursor-pointer z-20 font-bold">X</div>
                    <button id="real-x" class="absolute bottom-1 right-1 w-6 h-6 flex items-center justify-center text-[10px] text-white/30 bg-black/10 z-30">ë‹«ê¸°</button>
                </div>
            `;
            window.fake = (m) => { alert(m); };
            document.getElementById('real-x').onclick = () => { nextLevel(); };
        }

        function renderLevel9(el) {
            const safe = Math.floor(Math.random() * 6);
            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full px-4">
                    <i data-lucide="download-cloud" class="w-10 h-10 text-green-600 mb-4"></i>
                    <h3 class="font-bold mb-2">ì§„ì§œ ë‹¤ìš´ë¡œë“œ ì°¾ê¸°</h3>
                    <p class="text-sm text-gray-500 mb-8 text-center">íŒŒì¼ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ê´‘ê³ ê°€ ì•„ë‹Œ <span class="font-bold text-red-500">ì§„ì§œ ë²„íŠ¼</span>ì„ í´ë¦­í•˜ì„¸ìš”.</p>
                    <div class="grid grid-cols-2 gap-3 w-full">
                        ${[0, 1, 2, 3, 4, 5].map(i => `
                            <button onclick="window.lv9(${i})" class="h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded shadow-md flex items-center justify-center gap-2 text-sm">
                                <i data-lucide="download" class="w-4 h-4"></i> Download
                            </button>
                        `).join('')}
                    </div>
                    <p class="text-[10px] text-gray-300 mt-4">Sponsored Links included</p>
                </div>
            `;
            lucide.createIcons();
            window.lv9 = (i) => {
                if (i === safe) {
                    alert("ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë©ë‹ˆë‹¤. (ì„±ê³µ)");
                    nextLevel();
                } else {
                    alert("ê´‘ê³  í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤... (ë‚šì‹œ)");
                }
            };
        }

        function renderLevel10(el) {
            const colorOptions = [
                "Red", "Orange", "Yellow", "Green", "Blue", "Indigo", "Purple", "Pink", "Mint", "Cyan",
                "Brown", "Lime", "Magenta", "Teal", "Olive", "Maroon", "Gold", "Silver",
                "Navy", "Grey", "Beige"
            ];

            const validColors = ["Navy", "Grey", "Beige"];
            const validSizes = [95, 100, 105];

            const targetColor = validColors[Math.floor(Math.random() * validColors.length)];
            const targetSize = validSizes[Math.floor(Math.random() * validSizes.length)];

            let currColorIdx = 0;
            let currSize = 50;

            function updateUI() {
                document.getElementById('display-color').innerText = colorOptions[currColorIdx];
                document.getElementById('display-color').style.color = colorOptions[currColorIdx].toLowerCase();
                document.getElementById('display-size').innerText = currSize;

                const box = document.getElementById('preview-box');
                box.style.backgroundColor = colorOptions[currColorIdx].toLowerCase();
            }

            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full px-4 select-none overflow-y-auto">
                    <div class="flex items-center gap-2 mb-2">
                        <i data-lucide="shopping-bag" class="w-6 h-6 text-slate-700"></i>
                        <h3 class="font-bold text-lg">ì´ˆíŠ¹ê°€ ë§¨íˆ¬ë§¨</h3>
                    </div>
                    <div class="bg-yellow-50 px-4 py-2 rounded-lg border border-yellow-200 mb-6 text-center shadow-sm">
                        <p class="text-xs text-gray-500">ì£¼ë¬¸ ëª©í‘œ:</p>
                        <p class="font-bold text-lg text-slate-800">
                            <span class="text-${targetColor === 'Navy' ? 'blue-900' : targetColor === 'Grey' ? 'gray-500' : 'yellow-700'}">${targetColor}</span> 
                            / Size ${targetSize}
                        </p>
                    </div>

                    <div id="preview-box" class="w-24 h-24 rounded-lg shadow-inner border border-slate-200 mb-6 transition-colors duration-200 flex items-center justify-center text-white font-bold text-xl shadow-lg">
                        <span id="display-size">50</span>
                    </div>

                    <div class="w-full space-y-4 mb-8">
                        <div class="flex items-center justify-between bg-white border p-3 rounded-lg shadow-sm">
                            <span class="text-sm font-bold text-gray-500 w-12">Color</span>
                            <div class="flex-1 text-center font-mono font-bold text-lg" id="display-color">Red</div>
                            <button id="btn-color" class="w-12 h-12 bg-slate-100 rounded hover:bg-slate-200 flex items-center justify-center active:bg-slate-300">
                                <i data-lucide="rotate-cw" class="w-5 h-5"></i>
                            </button>
                        </div>

                        <div class="flex items-center justify-between bg-white border p-3 rounded-lg shadow-sm">
                            <span class="text-sm font-bold text-gray-500 w-12">Size</span>
                            <div class="flex-1 text-center text-xs text-gray-400">
                                (50~200, +5 ë‹¨ìœ„)
                            </div>
                            <button id="btn-size" class="w-12 h-12 bg-slate-100 rounded hover:bg-slate-200 flex items-center justify-center active:bg-slate-300 font-bold text-blue-600">
                                +5
                            </button>
                        </div>
                    </div>

                    <button id="btn-buy" class="w-full py-4 bg-slate-900 text-white font-bold rounded-xl shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2">
                        <i data-lucide="credit-card" class="w-5 h-5"></i> êµ¬ë§¤í•˜ê¸°
                    </button>
                </div>
            `;
            lucide.createIcons();

            updateUI();

            document.getElementById('btn-color').onclick = () => {
                currColorIdx = (currColorIdx + 1) % colorOptions.length;
                updateUI();
            };

            document.getElementById('btn-size').onclick = () => {
                currSize += 5;
                if (currSize > 200) currSize = 50;
                updateUI();
            };

            document.getElementById('btn-buy').onclick = () => {
                const selectedColor = colorOptions[currColorIdx];

                if (selectedColor === targetColor && currSize === targetSize) {
                    alert("ì£¼ë¬¸ ì„±ê³µ! ë°°ì†¡ì¤€ë¹„ì¤‘...");
                    nextLevel();
                } else {
                    let msg = "ì˜µì…˜ ì˜¤ë¥˜:\n";
                    if (selectedColor !== targetColor) msg += `- ìƒ‰ìƒì´ ë‹¤ë¦…ë‹ˆë‹¤ (ì„ íƒ: ${selectedColor})\n`;
                    if (currSize !== targetSize) msg += `- ì‚¬ì´ì¦ˆê°€ ë‹¤ë¦…ë‹ˆë‹¤ (ì„ íƒ: ${currSize})`;
                    alert(msg);
                }
            };
        }

        // ==========================================
        // 4. íˆ¬í‘œ ë° ê²°ê³¼
        // ==========================================

        function showVoting() {
            clearAllTimers();
            state.view = 'voting';
            const list = state.levels.map(l => `
                <label class="flex items-center p-4 rounded-xl border-2 cursor-pointer transition-all border-slate-100 hover:bg-slate-50" id="vl-${l.id}" onclick="selVote(${l.id})">
                    <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center mr-4 border-slate-300" id="vc-${l.id}"><div class="w-3 h-3 bg-indigo-600 rounded-full hidden" id="vd-${l.id}"></div></div>
                    <div><p class="font-bold text-slate-700" id="vt-${l.id}">${l.title}</p><p class="text-xs text-slate-400">Entry No. ${l.id}</p></div>
                </label>
            `).join('');

            render(`
                <div class="flex-1 flex flex-col bg-slate-50 overflow-hidden">
                    <div class="bg-indigo-600 p-6 text-white text-center shrink-0">
                        <h1 class="text-xl font-bold">ì²´í—˜ ì¢…ë£Œ!</h1>
                        <p class="opacity-80 text-sm mt-1">ìµœì•…ì˜ UXì— íˆ¬í‘œí•˜ì„¸ìš”.</p>
                    </div>
                    <div class="p-6 overflow-y-auto flex-grow hide-scrollbar"><div class="space-y-3">${list}</div></div>
                    <div class="p-6 border-t border-slate-100 shrink-0 bg-white">
                        <button onclick="subVote()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 active:scale-95"><i data-lucide="send" class="w-5 h-5"></i> íˆ¬í‘œ ì œì¶œí•˜ê¸°</button>
                    </div>
                </div>
            `);
            window.selVote = (id) => {
                state.selectedVote = id;
                state.levels.forEach(l => {
                    const active = l.id === id;
                    const lb = document.getElementById(`vl-${l.id}`);
                    lb.className = `flex items-center p-4 rounded-xl border-2 cursor-pointer transition-all ${active ? 'border-indigo-600 bg-indigo-50 ring-2 ring-indigo-200' : 'border-slate-100 hover:bg-slate-50'}`;
                    document.getElementById(`vc-${l.id}`).className = `w-6 h-6 rounded-full border-2 flex items-center justify-center mr-4 ${active ? 'border-indigo-600' : 'border-slate-300'}`;
                    document.getElementById(`vd-${l.id}`).classList.toggle('hidden', !active);
                    document.getElementById(`vt-${l.id}`).className = `font-bold ${active ? 'text-indigo-900' : 'text-slate-700'}`;
                });
            };
            window.subVote = () => { if (state.selectedVote) showResult(); else alert("ì„ íƒí•´ì£¼ì„¸ìš”!"); };
        }

        function showResult() {
            clearAllTimers();
            const pick = state.levels.find(l => l.id === state.selectedVote);
            render(`
                <div class="flex-1 flex flex-col items-center justify-center p-6 font-sans text-center bg-slate-100">
                    <div class="max-w-md w-full bg-white rounded-3xl shadow-xl p-8">
                        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 text-4xl animate-bounce">ğŸ—³ï¸</div>
                        <h2 class="text-2xl font-bold mb-2 text-slate-800">íˆ¬í‘œ ì™„ë£Œ!</h2>
                        <div class="my-8"><p class="text-slate-500 mb-2">ë‹¹ì‹ ì˜ ì„ íƒ:</p><div class="inline-block bg-slate-100 px-6 py-3 rounded-full font-bold text-slate-800 border border-slate-200">${pick?.title}</div></div>
                        <button onclick="showIntro()" class="w-full bg-slate-800 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 hover:bg-slate-900 transition-colors"><i data-lucide="refresh-ccw" class="w-4 h-4"></i> ì²˜ìŒìœ¼ë¡œ</button>
                    </div>
                </div>
            `);
        }
    </script>
</body>

</html>