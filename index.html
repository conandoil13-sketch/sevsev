<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KUIS ì œ12íšŒ ë¶ˆí¸í•œ í´ë¦­ UI ë§Œë“¤ê¸° ëŒ€íšŒ</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- ClickBattle Script -->
    <script src="https://clickbattle2025.web.app/click-battle.js"></script>

    <style>
        /* ì»¤ìŠ¤í…€ ì• ë‹ˆë©”ì´ì…˜ & ìœ í‹¸ë¦¬í‹° */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        @keyframes pulse-red {

            0%,
            100% {
                color: #fca5a5;
            }

            50% {
                color: #ef4444;
            }
        }

        .animate-pulse-red {
            animation: pulse-red 2s infinite;
        }

        .no-select {
            user-select: none;
            -webkit-user-select: none;
        }

        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¹€ (ê¹”ë”í•œ UI) */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>

<body
    class="bg-slate-50 text-slate-800 font-sans min-h-screen flex flex-col items-center justify-center overflow-hidden">

    <!-- ì•± ì»¨í…Œì´ë„ˆ -->
    <div id="app"
        class="w-full max-w-md h-screen max-h-screen relative flex flex-col bg-white sm:rounded-3xl sm:h-[90vh] sm:shadow-2xl sm:border border-slate-100 overflow-hidden">
        <!-- ë™ì  ì½˜í…ì¸ ê°€ ì´ê³³ì— ë Œë”ë§ë©ë‹ˆë‹¤ -->
    </div>

    <script>
        // ==========================================
        // 1. ì „ì—­ ìƒíƒœ ë° ìœ í‹¸ë¦¬í‹°
        // ==========================================
        const state = {
            view: 'intro', // intro, playing, voting, result
            levels: [],
            currentLevelIndex: 0,
            selectedVote: null,
            skipClickCount: 0,
            skipVisible: false,
            timers: [] // cleanupìš©
        };

        // í´ë¦­ ë°°í‹€ íŠ¸ë˜í‚¹ í•¨ìˆ˜
        function trackClick() {
            if (window.ClickBattle && typeof window.ClickBattle.recordClick === 'function') {
                window.ClickBattle.recordClick();
                // console.log("Click Recorded!"); 
            }
        }

        // ë°°ì—´ ì„ê¸°
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // íƒ€ì´ë¨¸ ì •ë¦¬ (ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€)
        function clearAllTimers() {
            state.timers.forEach(t => clearInterval(t));
            state.timers.forEach(t => clearTimeout(t));
            state.timers = [];
        }

        // í™”ë©´ ë Œë”ë§ í—¬í¼
        function render(htmlString) {
            const app = document.getElementById('app');
            app.innerHTML = htmlString;
            lucide.createIcons(); // ì•„ì´ì½˜ ë Œë”ë§
        }

        // ì´ˆê¸°í™”
        window.onload = function () {
            if (window.ClickBattle) {
                window.ClickBattle.init("1004");
                console.log("ClickBattle initialized: 1004");
            }
            showIntro();
        };

        // ==========================================
        // 2. í™”ë©´ë³„ ë Œë”ë§ í•¨ìˆ˜
        // ==========================================

        // --- ì¸íŠ¸ë¡œ í™”ë©´ ---
        function showIntro() {
            clearAllTimers();
            render(`
                <div class="flex-1 flex flex-col bg-slate-50">
                    <div class="bg-slate-900 p-8 text-white text-center rounded-b-3xl shadow-lg z-10">
                        <i data-lucide="mouse-pointer-2" class="w-16 h-16 mx-auto mb-6 text-yellow-400"></i>
                        <h1 class="text-2xl font-black tracking-tight mb-2">KUIS ì œ12íšŒ</h1>
                        <p class="text-slate-400 font-light">ë¶ˆí¸í•œ í„°ì¹˜ UI ë§Œë“¤ê¸° ëŒ€íšŒ</p>
                    </div>
                    <div class="p-8 flex-1 flex flex-col justify-center animate-fade-in">
                        <div class="bg-yellow-50 p-5 rounded-2xl border border-yellow-100 text-sm text-yellow-900 leading-relaxed mb-8 shadow-sm">
                            <div class="flex items-center gap-2 font-bold mb-2 text-yellow-700">
                                <i data-lucide="alert-triangle" class="w-4 h-4"></i> <span>ëŒ€íšŒ ì•ˆë‚´</span>
                            </div>
                            ë³¸ ì‚¬ì´íŠ¸ëŠ” ë³¸ì„  ì§„ì¶œì‘ <span class="font-bold border-b border-yellow-500">10ì„ </span>ì„ ëœë¤í•˜ê²Œ ì œê³µí•©ë‹ˆë‹¤.
                            <br><br>
                            ì˜¤ì§ <strong>'í„°ì¹˜(Touch)'</strong> ë§Œìœ¼ë¡œ ëª¨ë“  ë‚œê´€ì„ ê·¹ë³µí•˜ê³ , ê°€ì¥ ë‹¹ì‹ ì„ í™”ë‚˜ê²Œ ë§Œë“  ì‘í’ˆì— íˆ¬í‘œí•´ì£¼ì„¸ìš”.
                        </div>
                        <button onclick="startGame()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-blue-200 transition-all active:scale-95 flex items-center justify-center gap-2">
                            ì‹¬ì‚¬ ì‹œì‘í•˜ê¸° <i data-lucide="chevron-right" class="w-5 h-5"></i>
                        </button>
                    </div>
                </div>
            `);
        }

        function startGame() {
            trackClick();
            // ë ˆë²¨ ì •ì˜
            const rawLevels = [
                { id: 1, title: 'ìƒë…„ì›”ì¼ ë…¸ê°€ë‹¤', render: renderLevel1 },
                { id: 2, title: 'ëœë¤ ê°ë„ ë³¼ë¥¨', render: renderLevel2 },
                { id: 3, title: 'ë°‘ ë¹ ì§„ ë…(íŒí”„)', render: renderLevel3 },
                { id: 4, title: 'ë§ˆìŒì˜ ëˆˆ(3ì´ˆ)', render: renderLevel4 },
                { id: 5, title: 'ë³´ì•ˆ í‚¤íŒ¨ë“œ', render: renderLevel5 },
                { id: 6, title: 'ì ‘ì´‰ ë¶ˆëŸ‰ ë²„íŠ¼', render: renderLevel6 },
                { id: 7, title: 'ìƒ‰ê¹” ë°˜ì‚¬ ì‹ ê²½', render: renderLevel7 },
                { id: 8, title: 'ê´‘ê³ ì˜ ëŠª', render: renderLevel8 },
                { id: 9, title: 'ì§€ë¢° ì°¾ê¸°', render: renderLevel9 },
                { id: 10, title: 'ì§€ë¬¸ ì¸ì‹', render: renderLevel10 },
            ];
            state.levels = shuffleArray(rawLevels);
            state.currentLevelIndex = 0;
            state.view = 'playing';
            loadLevel();
        }

        // --- ê²Œì„ í”Œë ˆì´ í™”ë©´ (ê³µí†µ í”„ë ˆì„) ---
        function loadLevel() {
            clearAllTimers();
            const level = state.levels[state.currentLevelIndex];
            const progress = ((state.currentLevelIndex) / state.levels.length) * 100;

            // ê¸°ë³¸ í”„ë ˆì„ ë Œë”ë§
            render(`
                <div class="flex-1 flex flex-col bg-slate-100 p-4 pt-8 font-sans h-full relative">
                    <!-- ìƒë‹¨ ì§„í–‰ë°” -->
                    <div class="bg-white px-6 py-4 rounded-2xl shadow-sm flex items-center justify-between mb-4 z-10">
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Progress</span>
                        <div class="flex items-center gap-3 flex-1 ml-4">
                            <div class="w-full bg-slate-100 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full transition-all duration-500" style="width: ${progress}%"></div>
                            </div>
                            <span class="text-sm font-bold text-blue-600 w-10 text-right">${state.currentLevelIndex + 1}/${state.levels.length}</span>
                        </div>
                    </div>

                    <!-- ê²Œì„ ì˜ì—­ -->
                    <div class="bg-white rounded-3xl shadow-xl overflow-hidden flex-1 flex flex-col relative border border-slate-100 z-0">
                        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"></div>
                        <div class="px-6 py-4 border-b border-slate-50 flex justify-between items-center bg-slate-50/50">
                            <h2 class="font-bold text-slate-700">Entry No. ${level.id}</h2>
                            <span class="text-xs bg-slate-200 text-slate-600 px-2 py-1 rounded-md font-bold">${level.title}</span>
                        </div>
                        <div id="game-content" class="flex-grow relative overflow-hidden">
                            <!-- ê°œë³„ ê²Œì„ ì»¨í…ì¸  ì£¼ì… -->
                        </div>
                    </div>

                    <!-- ìŠ¤í‚µ ë²„íŠ¼ ì˜ì—­ -->
                    <div id="skip-container" class="mt-4 w-full h-12"></div>

                    <p class="text-center text-xs text-slate-400 pb-2 mt-2">
                        * íŒ: ì§„ì •í•˜ì‹œê³  ì†ê°€ë½ ëì— ì§‘ì¤‘í•˜ì„¸ìš”.
                    </p>
                </div>
            `);

            // ê°œë³„ ê²Œì„ ë¡œì§ ì‹¤í–‰
            level.render(document.getElementById('game-content'));

            // ìŠ¤í‚µ ë²„íŠ¼ ë¡œì§ ì´ˆê¸°í™”
            initSkipButton();
        }

        function nextLevel() {
            if (state.currentLevelIndex < state.levels.length - 1) {
                state.currentLevelIndex++;
                loadLevel();
            } else {
                showVoting();
            }
        }

        // --- ìŠ¤í‚µ ë²„íŠ¼ ë¡œì§ ---
        function initSkipButton() {
            state.skipClickCount = 0;
            const container = document.getElementById('skip-container');

            // 7ì´ˆ í›„ ë“±ì¥
            const timer = setTimeout(() => {
                renderSkipButton(container);
            }, 7000);
            state.timers.push(timer);
        }

        function renderSkipButton(container) {
            const count = state.skipClickCount;
            const required = 20;

            let btnClass = count > 0
                ? 'border-red-200 bg-red-50 text-red-500 active:scale-95'
                : 'border-slate-200 bg-white text-slate-400 hover:bg-slate-50';

            let html = `
                <button id="btn-skip" class="w-full py-3 rounded-xl border-2 font-bold text-sm transition-all flex items-center justify-center gap-2 animate-fade-in ${btnClass}">
                    ${count === 0
                    ? `<i data-lucide="help-circle" class="w-4 h-4"></i> ë„ˆë¬´ ë‹µë‹µí•˜ì‹ ê°€ìš”? (ë‹¤ìŒ ë‹¨ê³„ë¡œ)`
                    : `<span class="text-red-600 font-black text-lg">ê±´ë„ˆë›°ê¸° ìŠ¹ì¸ ì¤‘... (${count}/${required})</span>`
                }
                </button>
            `;

            if (count > 0 && count < required) {
                html += `<p class="text-[10px] text-center text-red-300 mt-1 animate-pulse-red">* ì‹œìŠ¤í…œ ë¶€í•˜ë¡œ ì¸í•´ ì—¬ëŸ¬ ë²ˆ í´ë¦­í•´ì•¼ í•©ë‹ˆë‹¤.</p>`;
            }

            container.innerHTML = html;
            lucide.createIcons();

            document.getElementById('btn-skip').onclick = () => {
                trackClick();
                state.skipClickCount++;
                if (state.skipClickCount >= required) {
                    nextLevel();
                } else {
                    renderSkipButton(container); // ë¦¬ë Œë”ë§
                }
            };
        }


        // ==========================================
        // 3. ê°œë³„ ë¯¸ë‹ˆê²Œì„ ë¡œì§
        // ==========================================

        // Level 1: ìƒë…„ì›”ì¼ ë…¸ê°€ë‹¤
        function renderLevel1(el) {
            let y = 1990, m = 1, d = 1;
            const target = { y: 1999, m: 12, d: 31 };

            function updateDisplay() {
                document.getElementById('date-y').innerText = y;
                document.getElementById('date-m').innerText = m;
                document.getElementById('date-d').innerText = d;
            }

            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full p-4">
                    <h3 class="font-bold text-lg mb-2">ìƒë…„ì›”ì¼ ì…ë ¥</h3>
                    <p class="text-sm text-gray-500 mb-6">ëª©í‘œ: <span class="text-blue-600 font-bold">1999ë…„ 12ì›” 31ì¼</span></p>
                    <div class="flex gap-2 mb-8">
                        <div class="flex flex-col items-center">
                            <div id="date-y" class="w-20 h-12 flex items-center justify-center bg-gray-100 rounded border mb-2 font-mono text-lg font-bold">1990</div>
                            <button id="btn-y" class="w-20 h-12 bg-white border-2 border-blue-200 rounded-lg active:bg-blue-100 active:scale-95 text-blue-600 font-bold">+1</button>
                            <span class="text-xs text-gray-400 mt-1">ë…„</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <div id="date-m" class="w-20 h-12 flex items-center justify-center bg-gray-100 rounded border mb-2 font-mono text-lg font-bold">1</div>
                            <button id="btn-m" class="w-20 h-12 bg-white border-2 border-blue-200 rounded-lg active:bg-blue-100 active:scale-95 text-blue-600 font-bold">+1</button>
                            <span class="text-xs text-gray-400 mt-1">ì›”</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <div id="date-d" class="w-20 h-12 flex items-center justify-center bg-gray-100 rounded border mb-2 font-mono text-lg font-bold">1</div>
                            <button id="btn-d" class="w-20 h-12 bg-white border-2 border-blue-200 rounded-lg active:bg-blue-100 active:scale-95 text-blue-600 font-bold">+1</button>
                            <span class="text-xs text-gray-400 mt-1">ì¼</span>
                        </div>
                    </div>
                    <p class="text-xs text-red-400 mb-4">* ì£¼ì˜: ë²”ìœ„ë¥¼ ë„˜ì–´ê°€ë©´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.</p>
                    <button id="btn-check" class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">í™•ì¸</button>
                </div>
            `;

            document.getElementById('btn-y').onclick = () => { trackClick(); y++; if (y > 2000) y = 1990; updateDisplay(); };
            document.getElementById('btn-m').onclick = () => { trackClick(); m++; if (m > 12) m = 1; updateDisplay(); };
            document.getElementById('btn-d').onclick = () => { trackClick(); d++; if (d > 31) d = 1; updateDisplay(); };
            document.getElementById('btn-check').onclick = () => {
                trackClick();
                if (y === target.y && m === target.m && d === target.d) nextLevel();
                else alert("ëª©í‘œ ë‚ ì§œì™€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            };
        }

        // Level 2: ëœë¤ ë³¼ë¥¨
        function renderLevel2(el) {
            let vol = 50;
            const target = 75;

            function updateDisplay() {
                document.getElementById('vol-display').innerText = vol;
            }

            function changeVol(dir) {
                trackClick();
                const jump = Math.floor(Math.random() * 15) + 1;
                vol = (dir === 'up') ? vol + jump : vol - jump;
                if (vol < 0) vol = 0; if (vol > 100) vol = 100;
                updateDisplay();
            }

            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full px-6">
                    <i data-lucide="volume-2" class="w-10 h-10 text-gray-400 mb-4"></i>
                    <h3 class="font-bold mb-6">ë³¼ë¥¨ ë¯¸ì„¸ ì¡°ì •</h3>
                    <p class="mb-8">ì •í™•íˆ <span class="text-red-500 font-black text-xl">${target}</span>ì— ë§ì¶”ì„¸ìš”.</p>
                    <div id="vol-display" class="text-5xl font-mono font-bold text-indigo-600 mb-8">50</div>
                    <div class="flex gap-4 w-full">
                        <button id="btn-down" class="flex-1 bg-red-100 text-red-600 py-6 rounded-xl font-bold active:bg-red-200">DOWN</button>
                        <button id="btn-up" class="flex-1 bg-blue-100 text-blue-600 py-6 rounded-xl font-bold active:bg-blue-200">UP</button>
                    </div>
                    <button id="btn-ok" class="mt-8 w-full bg-gray-800 text-white py-3 rounded-xl font-bold">ì„¤ì • ì™„ë£Œ</button>
                </div>
            `;
            lucide.createIcons();

            document.getElementById('btn-down').onclick = () => changeVol('down');
            document.getElementById('btn-up').onclick = () => changeVol('up');
            document.getElementById('btn-ok').onclick = () => {
                trackClick();
                if (vol === target) nextLevel();
                else alert(`í˜„ì¬: ${vol} / ëª©í‘œ: ${target}`);
            };
        }

        // Level 3: íŒí”„
        function renderLevel3(el) {
            let progress = 0;

            const timer = setInterval(() => {
                progress = Math.max(0, progress - 2);
                updateBar();
            }, 50);
            state.timers.push(timer);

            function updateBar() {
                const bar = document.getElementById('pump-bar');
                if (bar) bar.style.width = `${progress}%`;
                const icon = document.getElementById('pump-icon');
                if (icon) {
                    if (progress > 80) icon.classList.replace('text-gray-400', 'text-green-500');
                    else icon.classList.replace('text-green-500', 'text-gray-400');
                }
            }

            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full px-6 text-center no-select">
                    <i id="pump-icon" data-lucide="battery-charging" class="w-10 h-10 text-gray-400 mb-4 transition-colors"></i>
                    <h3 class="font-bold mb-2">ìˆ˜ë™ ì¶©ì „ê¸°</h3>
                    <p class="text-sm text-gray-500 mb-6">ê²Œì´ì§€ê°€ ì¤„ì–´ë“¤ê¸° ì „ì—<br>ì—°íƒ€í•´ì„œ 100%ë¥¼ ë§Œë“œì„¸ìš”.</p>
                    <div class="w-full h-8 bg-gray-200 rounded-full overflow-hidden mb-8 border border-gray-300">
                        <div id="pump-bar" class="h-full bg-green-500 transition-all duration-75 ease-linear" style="width: 0%"></div>
                    </div>
                    <button id="btn-tap" class="w-32 h-32 rounded-full bg-red-500 text-white font-bold text-xl shadow-[0_6px_0_rgb(185,28,28)] active:shadow-none active:translate-y-[6px] transition-all flex items-center justify-center">
                        TAP!
                    </button>
                </div>
            `;
            lucide.createIcons();

            const btn = document.getElementById('btn-tap');
            const handleTap = (e) => {
                e.preventDefault();
                trackClick();
                progress += 5;
                if (progress >= 100) nextLevel();
                updateBar();
            };
            btn.addEventListener('mousedown', handleTap);
            btn.addEventListener('touchstart', handleTap);
        }

        // Level 4: ë¸”ë¼ì¸ë“œ íƒ€ì´ë¨¸
        function renderLevel4(el) {
            let startTime = 0;
            let pressing = false;

            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full px-6 select-none">
                    <i data-lucide="rotate-ccw" class="w-10 h-10 text-orange-500 mb-4"></i>
                    <h3 class="font-bold mb-2">ë§ˆìŒì˜ ëˆˆ</h3>
                    <p class="text-sm text-gray-500 mb-8 text-center">3ì´ˆ ë™ì•ˆ ëˆ„ë¥´ê³  ìˆë‹¤ê°€ ë–¼ì„¸ìš”.<br>(ì‹œê³„ ì—†ìŒ)</p>
                    <button id="btn-timer" class="w-full py-12 rounded-xl text-xl font-bold transition-all bg-orange-100 text-orange-600">
                        ëˆ„ë¥´ê³  ìˆìœ¼ì„¸ìš”
                    </button>
                </div>
            `;
            lucide.createIcons();

            const btn = document.getElementById('btn-timer');

            const start = (e) => {
                e.preventDefault();
                trackClick();
                pressing = true;
                startTime = Date.now();
                btn.innerText = "...";
                btn.classList.replace('bg-orange-100', 'bg-orange-600');
                btn.classList.replace('text-orange-600', 'text-white');
                btn.classList.add('scale-95');
            };

            const end = (e) => {
                e.preventDefault();
                if (!pressing) return;
                pressing = false;
                const duration = (Date.now() - startTime) / 1000;

                btn.classList.replace('bg-orange-600', 'bg-orange-100');
                btn.classList.replace('text-white', 'text-orange-600');
                btn.classList.remove('scale-95');
                btn.innerText = "ëˆ„ë¥´ê³  ìˆìœ¼ì„¸ìš”";

                if (duration >= 3.0 && duration <= 3.5) nextLevel();
                else alert(`ì‹¤íŒ¨! ê¸°ë¡: ${duration.toFixed(2)}ì´ˆ.\n3.0~3.5ì´ˆ ì‚¬ì´ë¥¼ ë…¸ë¦¬ì„¸ìš”.`);
            };

            btn.addEventListener('mousedown', start);
            btn.addEventListener('mouseup', end);
            btn.addEventListener('touchstart', start);
            btn.addEventListener('touchend', end);
        }

        // Level 5: ë³´ì•ˆ í‚¤íŒ¨ë“œ
        function renderLevel5(el) {
            let input = "";
            let keys = [1, 2, 3, 4, 5, 6, 7, 8, 9];
            const target = "2580";

            function renderKeys() {
                const container = document.getElementById('keypad-grid');
                container.innerHTML = '';
                keys.forEach(k => {
                    const btn = document.createElement('button');
                    btn.className = "bg-white border-b-4 border-slate-200 active:border-b-0 active:mt-1 h-16 rounded-lg text-xl font-bold text-slate-700 shadow-sm";
                    btn.innerText = k;
                    btn.onclick = () => handleKey(k);
                    container.appendChild(btn);
                });
            }

            function handleKey(num) {
                trackClick();
                input += num;
                document.getElementById('keypad-display').innerText = input.padEnd(4, '*');

                if (input === target) nextLevel();
                else if (input.length >= 4) {
                    setTimeout(() => { alert("ì˜¤ë‹µ! ì´ˆê¸°í™”."); input = ""; document.getElementById('keypad-display').innerText = "****"; }, 100);
                }

                keys = shuffleArray([1, 2, 3, 4, 5, 6, 7, 8, 9]); // ì…”í”Œ
                renderKeys();
            }

            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full px-4">
                    <i data-lucide="lock" class="w-10 h-10 text-slate-600 mb-4"></i>
                    <h3 class="font-bold mb-2">ë³´ì•ˆ í‚¤íŒ¨ë“œ</h3>
                    <p class="text-sm text-gray-500 mb-6">ë¹„ë°€ë²ˆí˜¸: <span class="text-blue-600 font-bold">${target}</span></p>
                    <div id="keypad-display" class="w-full bg-gray-100 p-4 rounded-lg mb-4 text-center text-2xl tracking-[1em] h-16 flex items-center justify-center font-bold">****</div>
                    <div id="keypad-grid" class="grid grid-cols-3 gap-2 w-full max-w-[300px]"></div>
                </div>
            `;
            lucide.createIcons();
            renderKeys();
        }

        // Level 6: ê³ ì¥ë‚œ ë²„íŠ¼
        function renderLevel6(el) {
            let count = 0;
            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full px-6">
                    <i data-lucide="zap" class="w-10 h-10 text-yellow-500 mb-4"></i>
                    <h3 class="font-bold mb-2">ì ‘ì´‰ ë¶ˆëŸ‰</h3>
                    <p class="text-sm text-gray-500 mb-8">ì‘ë™í•  ë•Œê¹Œì§€ ëˆ„ë¥´ì„¸ìš” (<span id="broken-count">0</span>/5)</p>
                    <button id="broken-btn" class="w-full py-8 bg-slate-200 text-slate-400 font-bold rounded shadow-inner active:bg-slate-300 active:scale-[0.99] transition-transform select-none">
                        ì‘ë™ì‹œí‚¤ê¸°
                    </button>
                </div>
            `;
            lucide.createIcons();

            document.getElementById('broken-btn').onclick = () => {
                trackClick();
                if (Math.random() < 0.2) {
                    count++;
                    document.getElementById('broken-count').innerText = count;
                    if (count >= 5) nextLevel();
                }
            };
        }

        // Level 7: ìŠ¤íŠ¸ë£¹
        function renderLevel7(el) {
            let stage = 0;
            const quizzes = [
                { text: "ë¹¨ê°•", colorClass: "text-blue-600", answer: "blue" },
                { text: "ì´ˆë¡", colorClass: "text-red-600", answer: "red" },
                { text: "íŒŒë‘", colorClass: "text-yellow-500", answer: "yellow" },
            ];

            function renderQuiz() {
                const q = quizzes[stage];
                const quizText = document.getElementById('stroop-text');
                quizText.innerText = q.text;
                quizText.className = `text-6xl font-black mb-12 ${q.colorClass}`;
                document.getElementById('stroop-stage').innerText = `${stage + 1}/3`;
            }

            function handleAnswer(val) {
                trackClick();
                if (val === quizzes[stage].answer) {
                    if (stage < 2) {
                        stage++;
                        renderQuiz();
                    } else nextLevel();
                } else {
                    alert("í‹€ë ¸ìŠµë‹ˆë‹¤! ê¸€ì ìƒ‰ì„ ëˆ„ë¥´ì„¸ìš”.");
                    stage = 0;
                    renderQuiz();
                }
            }

            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full px-4">
                    <i data-lucide="target" class="w-10 h-10 text-purple-500 mb-4"></i>
                    <h3 class="font-bold mb-2">ìƒ‰ê¹” ë°˜ì‚¬ ì‹ ê²½ (<span id="stroop-stage">1/3</span>)</h3>
                    <p class="text-sm text-gray-500 mb-8"><span class="font-bold text-black underline">ê¸€ì ìƒ‰ìƒ</span> ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</p>
                    <div id="stroop-text" class="text-6xl font-black mb-12"></div>
                    <div class="grid grid-cols-2 gap-4 w-full">
                        <button class="bg-red-500 text-white font-bold h-20 rounded-xl shadow-lg active:scale-95 transition-transform" onclick="window.handleStroop('red')">ë¹¨ê°•ìƒ‰</button>
                        <button class="bg-blue-600 text-white font-bold h-20 rounded-xl shadow-lg active:scale-95 transition-transform" onclick="window.handleStroop('blue')">íŒŒë‘ìƒ‰</button>
                        <button class="bg-green-600 text-white font-bold h-20 rounded-xl shadow-lg active:scale-95 transition-transform" onclick="window.handleStroop('green')">ì´ˆë¡ìƒ‰</button>
                        <button class="bg-yellow-500 text-white font-bold h-20 rounded-xl shadow-lg active:scale-95 transition-transform" onclick="window.handleStroop('yellow')">ë…¸ë‘ìƒ‰</button>
                    </div>
                </div>
            `;
            lucide.createIcons();

            // ì „ì—­ ìŠ¤ì½”í”„ì— í•¸ë“¤ëŸ¬ ë“±ë¡ (HTML onclick ìš©)
            window.handleStroop = handleAnswer;
            renderQuiz();
        }

        // Level 8: ê´‘ê³ 
        function renderLevel8(el) {
            el.innerHTML = `
                <div class="relative w-full h-80 bg-slate-800 rounded-xl overflow-hidden shadow-2xl flex flex-col items-center justify-center text-center p-4">
                    <div class="absolute inset-0 bg-gradient-to-br from-purple-600 to-blue-600 opacity-90"></div>
                    <div class="relative z-10 text-white">
                        <h2 class="text-3xl font-black text-yellow-300 animate-bounce mb-2">ë‹¹ì²¨ ì¶•í•˜!!</h2>
                        <p class="mb-6">ì•„ì´í° 50 Pro Max ë‹¹ì²¨!</p>
                        <button id="fake-btn-1" class="bg-green-500 text-white font-bold py-3 px-8 rounded-full shadow-lg transform active:scale-90 transition-transform">ìˆ˜ë ¹í•˜ê¸°</button>
                    </div>
                    <div id="fake-btn-2" class="absolute top-2 right-2 text-white/60 bg-black/20 p-1 rounded cursor-pointer z-20">
                        <div class="border border-white/50 px-1 text-[10px]">AD</div>
                    </div>
                    <div id="fake-btn-3" class="absolute top-2 left-2 text-white cursor-pointer z-20 font-bold">X</div>
                    <button id="real-close-btn" class="absolute bottom-1 right-1 w-6 h-6 flex items-center justify-center text-[10px] text-white/30 bg-black/10 z-30">ë‹«ê¸°</button>
                </div>
            `;

            const fakeAction = (msg) => { trackClick(); alert(msg); };
            document.getElementById('fake-btn-1').onclick = () => fakeAction("ë‚šì˜€ìŠµë‹ˆë‹¤.");
            document.getElementById('fake-btn-2').onclick = () => fakeAction("ê°€ì§œ ê´‘ê³ ");
            document.getElementById('fake-btn-3').onclick = () => fakeAction("ì´ë¯¸ì§€ë¥¼ í´ë¦­í–ˆìŠµë‹ˆë‹¤.");
            document.getElementById('real-close-btn').onclick = () => { trackClick(); nextLevel(); };
        }

        // Level 9: ë£°ë ›
        function renderLevel9(el) {
            const safeIndex = Math.floor(Math.random() * 6);

            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full px-4">
                    <i data-lucide="siren" class="w-10 h-10 text-red-500 mb-4"></i>
                    <h3 class="font-bold mb-2">ì§€ë¢° ì°¾ê¸°</h3>
                    <p class="text-sm text-gray-500 mb-8">6ê°œ ì¤‘ 1ê°œë§Œ ì •ë‹µì…ë‹ˆë‹¤.</p>
                    <div class="grid grid-cols-2 gap-4 w-full">
                        ${[0, 1, 2, 3, 4, 5].map(i => `
                            <button id="roulette-${i}" class="h-20 bg-white border-2 border-gray-200 rounded-xl hover:bg-gray-50 active:bg-red-50 font-bold text-gray-400 text-xl">?</button>
                        `).join('')}
                    </div>
                </div>
            `;
            lucide.createIcons();

            [0, 1, 2, 3, 4, 5].forEach(i => {
                document.getElementById(`roulette-${i}`).onclick = () => {
                    trackClick();
                    if (i === safeIndex) nextLevel();
                    else alert("ê½! ë‹¤ì‹œ ê³ ë¥´ì„¸ìš”.");
                };
            });
        }

        // Level 10: ì§€ë¬¸ ì¸ì‹
        function renderLevel10(el) {
            let progress = 0;
            let scanning = false;
            let interval = null;

            function updateUI() {
                const bar = document.getElementById('scan-bar');
                const icon = document.getElementById('scan-icon');
                const btn = document.getElementById('scan-btn');

                if (bar) bar.style.width = `${progress}%`;

                if (scanning) {
                    icon.classList.add('text-blue-500', 'animate-pulse');
                    icon.classList.remove('text-gray-300');
                    btn.classList.add('border-blue-500', 'bg-blue-50', 'scale-95');
                    btn.classList.remove('border-gray-300', 'bg-white');
                } else {
                    icon.classList.remove('text-blue-500', 'animate-pulse');
                    icon.classList.add('text-gray-300');
                    btn.classList.remove('border-blue-500', 'bg-blue-50', 'scale-95');
                    btn.classList.add('border-gray-300', 'bg-white');
                }
            }

            const startScan = (e) => {
                e.preventDefault();
                trackClick();
                scanning = true;
                updateUI();
                interval = setInterval(() => {
                    progress += (Math.random() > 0.7 ? 0 : 2);
                    if (progress >= 100) {
                        clearInterval(interval);
                        nextLevel();
                    }
                    updateUI();
                }, 50);
            };

            const stopScan = (e) => {
                if (e) e.preventDefault();
                scanning = false;
                clearInterval(interval);
                progress = 0;
                updateUI();
            };

            el.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full px-4 select-none">
                    <i id="scan-icon" data-lucide="fingerprint" class="w-14 h-14 mb-6 transition-colors text-gray-300"></i>
                    <h3 class="font-bold mb-2">ë³¸ì¸ ì¸ì¦</h3>
                    <p class="text-sm text-gray-500 mb-8">100%ê°€ ë  ë•Œê¹Œì§€ ê¾¹ ëˆ„ë¥´ì„¸ìš”.</p>
                    <div class="w-full h-4 bg-gray-200 rounded-full mb-8 overflow-hidden">
                        <div id="scan-bar" class="h-full bg-blue-500 transition-all duration-75" style="width: 0%"></div>
                    </div>
                    <button id="scan-btn" class="w-24 h-24 rounded-full border-4 flex items-center justify-center transition-all border-gray-300 bg-white">
                        <i data-lucide="fingerprint" class="w-10 h-10 text-gray-300"></i>
                    </button>
                </div>
            `;
            lucide.createIcons();

            const btn = document.getElementById('scan-btn');
            btn.addEventListener('mousedown', startScan);
            btn.addEventListener('mouseup', stopScan);
            btn.addEventListener('mouseleave', stopScan);
            btn.addEventListener('touchstart', startScan);
            btn.addEventListener('touchend', stopScan);
        }

        // --- íˆ¬í‘œ í™”ë©´ ---
        function showVoting() {
            clearAllTimers();
            state.view = 'voting';

            const listHtml = state.levels.map(level => `
                <label class="flex items-center p-4 rounded-xl border-2 cursor-pointer transition-all border-slate-100 hover:bg-slate-50" id="vote-label-${level.id}" onclick="selectVote(${level.id})">
                    <div class="w-6 h-6 rounded-full border-2 flex items-center justify-center mr-4 border-slate-300" id="vote-circle-${level.id}">
                        <div class="w-3 h-3 bg-indigo-600 rounded-full hidden" id="vote-dot-${level.id}"></div>
                    </div>
                    <input type="radio" name="vote" value="${level.id}" class="hidden">
                    <div>
                        <p class="font-bold text-slate-700" id="vote-text-${level.id}">${level.title}</p>
                        <p class="text-xs text-slate-400">Entry No. ${level.id}</p>
                    </div>
                </label>
            `).join('');

            render(`
                <div class="flex-1 flex flex-col bg-slate-50 overflow-hidden">
                    <div class="bg-indigo-600 p-6 text-white text-center shrink-0">
                        <h1 class="text-xl font-bold">ì²´í—˜ ì¢…ë£Œ!</h1>
                        <p class="opacity-80 text-sm mt-1">ìµœì•…ì˜ ì‚¬ìš©ì ê²½í—˜(UX)ì— íˆ¬í‘œí•˜ì„¸ìš”.</p>
                    </div>
                    <div class="p-6 overflow-y-auto flex-grow hide-scrollbar">
                        <div class="space-y-3">
                            ${listHtml}
                        </div>
                    </div>
                    <div class="p-6 border-t border-slate-100 shrink-0 bg-white">
                        <button onclick="submitVote()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transition-transform active:scale-95">
                            <i data-lucide="send" class="w-5 h-5"></i> íˆ¬í‘œ ì œì¶œí•˜ê¸°
                        </button>
                    </div>
                </div>
            `);
        }

        function selectVote(id) {
            trackClick();
            state.selectedVote = id;

            // UI ì—…ë°ì´íŠ¸
            state.levels.forEach(l => {
                const label = document.getElementById(`vote-label-${l.id}`);
                const circle = document.getElementById(`vote-circle-${l.id}`);
                const dot = document.getElementById(`vote-dot-${l.id}`);
                const text = document.getElementById(`vote-text-${l.id}`);

                if (l.id === id) {
                    label.classList.add('border-indigo-600', 'bg-indigo-50', 'ring-2', 'ring-indigo-200', 'ring-offset-1');
                    label.classList.remove('border-slate-100', 'hover:bg-slate-50');
                    circle.classList.replace('border-slate-300', 'border-indigo-600');
                    dot.classList.remove('hidden');
                    text.classList.replace('text-slate-700', 'text-indigo-900');
                } else {
                    label.classList.remove('border-indigo-600', 'bg-indigo-50', 'ring-2', 'ring-indigo-200', 'ring-offset-1');
                    label.classList.add('border-slate-100', 'hover:bg-slate-50');
                    circle.classList.replace('border-indigo-600', 'border-slate-300');
                    dot.classList.add('hidden');
                    text.classList.replace('text-indigo-900', 'text-slate-700');
                }
            });
        }

        function submitVote() {
            trackClick();
            if (state.selectedVote) showResult();
            else alert("í•˜ë‚˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!");
        }

        // --- ê²°ê³¼ í™”ë©´ ---
        function showResult() {
            clearAllTimers();
            const votedItem = state.levels.find(l => l.id === state.selectedVote);

            render(`
                <div class="flex-1 flex flex-col items-center justify-center p-6 font-sans text-center bg-slate-100">
                    <div class="max-w-md w-full bg-white rounded-3xl shadow-xl p-8">
                        <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 text-4xl animate-bounce">ğŸ—³ï¸</div>
                        <h2 class="text-2xl font-bold mb-2 text-slate-800">íˆ¬í‘œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
                        <div class="my-8">
                            <p class="text-slate-500 mb-2">ë‹¹ì‹ ì´ ì„ íƒí•œ ìµœì•…ì˜ UI:</p>
                            <div class="inline-block bg-slate-100 px-6 py-3 rounded-full font-bold text-slate-800 border border-slate-200">
                                ${votedItem ? votedItem.title : '???'}
                            </div>
                        </div>
                        <p class="text-sm text-slate-400 mb-8 leading-relaxed">ì—¬ëŸ¬ë¶„ì˜ ì†Œì¤‘í•œ ë¶„ë…¸ê°€<br>ë” ë‚˜ì€(í˜¹ì€ ë” ë‚˜ìœ) UI ì—°êµ¬ì— í™œìš©ë©ë‹ˆë‹¤.</p>
                        <button onclick="showIntro()" class="w-full bg-slate-800 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 hover:bg-slate-900 transition-colors">
                            <i data-lucide="refresh-ccw" class="w-4 h-4"></i> ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                </div>
            `);
        }
    </script>
</body>

</html>